<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ecsy-input webgl - geometry - cube</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
  </head>
  <body>
    <script type="module">
      import { Component, System } from "ecsy"
      import { ECSYThreeWorld, Object3DComponent, Types } from "ecsy-three"
      import {
        initialize,
        // Components
        GLTFLoader,
        // Systems
        GLTFLoaderSystem,
        Position
      } from "ecsy-three/extras"
      import {
        AmbientLight,
        Mesh,
        BoxBufferGeometry,
        MeshBasicMaterial,
        TextureLoader,
        Vector3
      } from "three"

      import { initializeInputSystems, InputReceiver, InputActionHandler, InputAxisHandler2D } from "../dist/ecsy-input.module.js"

      // Setup world
        const world = new ECSYThreeWorld()
        let data = initialize(world)
        let { scene, camera } = data.entities
        let camera3d = camera.getObject3D()
        camera3d.position.z = 5
        world.createEntity().addObject3DComponent(new AmbientLight(), scene)

          // Test input
          const inputOptions = {
          mouse: true,
          keyboard: true,
          touchscreen: true,
          gamepad: true,
          debug: true
        }

      // TODO: Import input mapping
      // TODO: Modify some values
      // TODO: Pass to world

        initializeInputSystems(world, inputOptions);

      world
        .createEntity()
        .addObject3DComponent(
          new Mesh(
            new BoxBufferGeometry(1, 1, 1),
            new MeshBasicMaterial({
              map: new TextureLoader().load("../examples/textures/crate.gif")
            })
          ),
          scene
        ).addComponent(InputReceiver)
        .addComponent(InputActionHandler)


      // DemoInputSystem
      class DemoInputSystem extends System {
        // This method will get called on every frame by default
        execute(delta, time) {
          // Iterate through all the entities on the query
          this.queries.input.results.forEach(entity => {
            var inputHandler = entity.getComponent(InputActionHandler);
            var lastAction = inputHandler.queue.pop();

            console.log('last action', lastAction);
          });
        }
      }

      // Define a query of entities that have "Velocity" and "Position" components
      DemoInputSystem.queries = {
        action: {
          components: [ InputReceiver, InputActionHandler ]
        },
        axis: {
          components: [ InputReceiver, InputAxisHandler2D ]
        }
      }
        world.registerSystem(DemoInputSystem)


        // Let's begin
        world.execute()
    </script>
  </body>
</html>
